name: Validate simulator

on:
  issues:
    types: [opened, edited]

jobs:
  validate:
    name: Validate
    runs-on: ubuntu-latest # includes Docker
    if: ${{ contains(github.event.issue.labels.*.name, 'Submit simulator') }}
    steps:
      - name: Install Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.7'
      - name: Install pip and setuptools
        run: |
          python -m pip install --upgrade pip
          python -m pip install --upgrade setuptools
      - name: Install simulator validation utilities
        run: python -m pip install git+https://github.com/biosimulations/Biosimulations_utils.git@align-with-api#egg=Biosimulations_utils[ci-actions]
      - name: Process submission
        env:
          GH_REPO: ${{ github.repository }}
          GH_ACTION_RUN_ID: ${{ github.run_id }}
          GH_ISSUE_NUMBER: ${{ github.event.issue.number }}
          GH_ISSUES_USER: ${{ secrets.GH_ISSUES_USER }}
          GH_ISSUES_ACCESS_TOKEN: ${{ secrets.GH_ISSUES_ACCESS_TOKEN }}
        run: |
          python - <<-EOF
          from Biosimulations_utils.ci_actions.validate_commit_simulator import ValidateSimulatorAction
          ValidateSimulatorAction().run()
          EOF
